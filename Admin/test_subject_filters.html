<!DOCTYPE html>
<html>

<head>
    <title>Subject Data Filter Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
        }
        
        .result {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
        }
        
        button {
            margin: 5px;
            padding: 10px 15px;
        }
    </style>
</head>

<body>
    <h1>Subject Attendance Filter Test</h1>

    <div class="test-section">
        <h3>Test Different Filters:</h3>
        <button onclick="testFilter('all')">All Time</button>
        <button onclick="testFilter('today')">Today</button>
        <button onclick="testFilter('week')">This Week</button>
        <button onclick="testFilter('month')">This Month</button>
    </div>

    <div class="test-section">
        <h3>Current Date Info:</h3>
        <p>Current Date: <span id="currentDate"></span></p>
        <p>Today Filter: DATE(dateTimeTaken) = CURDATE()</p>
        <p>Week Filter: dateTimeTaken >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)</p>
        <p>Month Filter: dateTimeTaken >= DATE_SUB(CURDATE(), INTERVAL 1 MONTH)</p>
    </div>

    <div class="test-section">
        <h3>Test Results:</h3>
        <div id="results"></div>
    </div>

    <script>
        // Show current date
        document.getElementById('currentDate').textContent = new Date().toISOString().split('T')[0];

        function testFilter(filter) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Loading ' + filter + ' data...</p>';

            fetch('debug_subject_data.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        filter: filter
                    })
                })
                .then(response => response.json())
                .then(data => {
                    let html = '<div class="result">';
                    html += '<h4>Filter: ' + filter + '</h4>';
                    html += '<p><strong>Records Found:</strong> ' + data.recordCount + '</p>';
                    html += '<p><strong>Date Condition:</strong> ' + (data.debug ? .date_condition || 'None') + '</p>';
                    html += '<p><strong>Filtered Count:</strong> ' + (data.debug ? .filtered_count || 'N/A') + '</p>';

                    if (data.debug ? .available_dates) {
                        html += '<p><strong>Available Dates in DB:</strong></p><ul>';
                        data.debug.available_dates.forEach(dateInfo => {
                            html += '<li>' + dateInfo.date + ' (' + dateInfo.count + ' records)</li>';
                        });
                        html += '</ul>';
                    }

                    if (data.classSubjects && data.classSubjects.length > 0) {
                        html += '<p><strong>Subjects Found:</strong></p><ul>';
                        data.classSubjects.forEach((subject, index) => {
                            html += '<li>' + subject + ' - ' + data.subjectData[index] + '%</li>';
                        });
                        html += '</ul>';
                    } else {
                        html += '<p style="color: red;"><strong>No subjects found for this filter!</strong></p>';
                    }

                    if (data.debug ? .query_error) {
                        html += '<p style="color: red;"><strong>Query Error:</strong> ' + data.debug.query_error + '</p>';
                    }

                    html += '</div>';
                    resultsDiv.innerHTML = html;
                })
                .catch(error => {
                    resultsDiv.innerHTML = '<div class="result"><p style="color: red;">Error: ' + error.message + '</p></div>';
                });
        }

        // Test all filter on page load
        testFilter('all');
    </script>
</body>

</html>